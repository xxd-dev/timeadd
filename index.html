<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Washing Mashine Time Calculator</title>
    <style>
        body {
            margin: 20px;
            background: #FFF1E8;
            color: #000000;
        }
        
        input {
            margin: 0;
            padding: 0;
            text-align: center;
            font-family: monospace;
            font-size: 1em;
        }
        
        pre {
            font-size: 1.1em;
        }
        
        .container {
            margin: auto;
            text-align: center;
        }
        
        .table {
            display: table;
            width: 100%;
            max-width: 40em;
            margin: 0 auto;
        }

        .row {
            display: table-row;
        }

        .cell {
            display: table-cell;
            padding: 0;
            border: none;
            text-align: center;
            vertical-align: middle;
            max-height: 1em;
            line-height: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <pre><b><u>Washing Mashine Time Calculator</u></b></pre>
    </div>
    <div class="table">
        <div class="row">
            <div class="cell"><pre>Time</pre></div>
            <div class="cell"><pre> </pre></div>
            <div class="cell"><pre>Cycle</pre></div>
            <div class="cell"><pre> </pre></div>
            <div class="cell"><pre>Wait</pre></div>
            <div class="cell"><pre> </pre></div>
            <div class="cell"><pre>End</pre></div>
        </div>
        <div class="row">
            <div class="cell"><input type="time" id="current-time" disabled></div>
            <div class="cell"><pre> + </pre></div>
            <div class="cell"><input type="time" id="cycle-time" value="00:00"></div>
            <div class="cell"><pre> + </pre></div>
            <div class="cell"><input type="time" id="offset-time" value="00:00"></div>
            <div class="cell"><pre> = </pre></div>
            <div class="cell"><input type="time" id="sum-time"></div>
        </div>
</div>
    <script>
        // Function to get the current real-time as an object {hours, minutes}
        let lastEdited = "offset";
        const urlParams = new URLSearchParams(window.location.search);
        const cycleTime = urlParams.get('t');
        if (cycleTime) {
            try {
                document.getElementById('cycle-time').value = cycleTime;
            } catch(err) {
                console.log(err.message);
            }
        }
        
        function getCurrentTime() {
            const now = new Date();
            return { hours: now.getHours(), minutes: now.getMinutes() };
        }

        function updateCurrentTimeDisplay() {
            const { hours, minutes } = getCurrentTime();
            document.getElementById('current-time').value = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            updateTimes();
        }
        
        function userEditedOffset() {
            lastEdited = "offset";
            updateTimes();
        }
        
        function userEditedSum() {
            lastEdited = "sum";
            updateTimes();
        }
        
        function userEditedCycle() {
            updateTimes();
        }

        function getTimeFromInput(inputId) {
            const [hours, minutes] = document.getElementById(inputId).value.split(':').map(Number);
            return {hours, minutes};
        }
        
        function updateTimes() {
            const currentTime = getTimeFromInput('current-time');
            const washTime = getTimeFromInput('cycle-time');
            const offsetTime = getTimeFromInput('offset-time');
            const sumTime = getTimeFromInput('sum-time');
            
            if (lastEdited == "offset") {
                let hours = currentTime.hours + offsetTime.hours + washTime.hours;
                let minutes = currentTime.minutes + offsetTime.minutes + washTime.minutes;

                if (minutes >= 60) {
                    hours += Math.floor(minutes / 60);
                    minutes %= 60;
                }

                hours %= 24;
                
                document.getElementById('sum-time').value = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            } else {
                let hours = sumTime.hours - currentTime.hours - washTime.hours;
                let minutes = sumTime.minutes - currentTime.minutes - washTime.minutes;
                while (minutes < 0) {
                    minutes += 60;
                    hours--;
                }

                while (hours < 0) {
                    hours += 24;
                }
                
                document.getElementById('offset-time').value = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            }
        }

        // Set event listeners for inputs
        document.getElementById('offset-time').addEventListener('input', userEditedOffset);
        document.getElementById('sum-time').addEventListener('input', userEditedSum);
        document.getElementById('cycle-time').addEventListener('input', userEditedCycle);
        document.getElementById('sum-time').addEventListener('focus', userEditedSum);
        
        updateCurrentTimeDisplay();
        setInterval(updateCurrentTimeDisplay, 100);  // Update the current time every second
    </script>
</body>
</html>
